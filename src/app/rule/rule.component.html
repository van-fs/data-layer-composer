<mat-expansion-panel expanded="true">
  <mat-expansion-panel-header>
    <mat-panel-title>
      {{ rule.id }}
    </mat-panel-title>
  </mat-expansion-panel-header>
  <div fxLayout="column" fxLayoutAlign="start stretch">
    <mat-list>
      <mat-list-item>
        <div fxLayout="row" fxLayoutAlign="start center">
          <mat-form-field>
            <mat-label>id</mat-label>
            <input required matInput [(ngModel)]="rule.id">
          </mat-form-field>
          <mat-checkbox class="spacer" matInput [(ngModel)]="rule.readOnLoad">readOnLoad</mat-checkbox>
          <mat-checkbox matInput [(ngModel)]="rule.monitor">monitor</mat-checkbox>
          <mat-checkbox matInput [(ngModel)]="rule.debug">debug</mat-checkbox>
        </div>
      </mat-list-item>
      <mat-list-item>
        <app-source class="full-width" [(source)]="rule.source" (target)="targetChange($event)"></app-source>
      </mat-list-item>
      <mat-list-item class="operators-list" *ngFor="let options of rule.operators">
        <div fxLayout="row" fxLayoutAlign="start center">
          <app-operator [options]="options" [source]="rule.source"></app-operator>
          <button class="spacer" mat-icon-button color="primary" (click)="removeOperator(options)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-list-item>
      <mat-list-item>
        <mat-form-field>
          <mat-label>destination</mat-label>
          <mat-select [(ngModel)]="rule.destination">
            <mat-option [value]="'FS.event'">FS.event</mat-option>
            <mat-option [value]="'FS.setUserVars'">FS.setUserVars</mat-option>
            <mat-option [value]="'FS.identify'">FS.identify</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-list-item>
    </mat-list>
    <div fxLayout="row" fxLayoutAlign="end center">
      <button *ngIf="!passed" mat-flat-button color="primary" [matMenuTriggerFor]="operators"
        [disabled]="target === null">Add
        Operator</button>
      <button *ngIf="!passed" mat-flat-button color="primary" (click)="register()"
        [disabled]="target === null">Register</button>
      <button *ngIf="passed" mat-stroked-button color="primary">Remove</button>
    </div>
  </div>
</mat-expansion-panel>

<mat-menu #operators="matMenu">
  <button mat-menu-item *ngFor="let alias of aliases" (click)="addOperator(alias)">
    <span>{{ alias }}</span>
  </button>
</mat-menu>
