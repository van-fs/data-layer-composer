<mat-toolbar color="primary">
  <button mat-button (click)="drawer.toggle()">
    <mat-icon>menu</mat-icon>
  </button>
  <span>Data Layer Composer</span>
  <span class="spacer"></span>
  <button mat-stroked-button [matMenuTriggerFor]="loader" matTooltip="Load data layer">
    <mat-icon>file_copy</mat-icon>
  </button>
  <button mat-stroked-button matTooltip="Add a data layer observer rule" (click)="addRule()">
    <mat-icon>add_circle</mat-icon>
  </button>
  <!--
  <button mat-stroked-button matTooltip="Run data layer observer" (click)="run()">
    <mat-icon>play_circle_filled</mat-icon>
  </button>
  -->
  <button mat-stroked-button matTooltip="Clear output and logs" (click)="clear()">
    <mat-icon>restore_page</mat-icon>
  </button>
  <button mat-stroked-button matTooltip="Save data layer and rules to local storage" (click)="save()">
    <mat-icon>save</mat-icon>
  </button>
</mat-toolbar>
<mat-drawer-container class="container" [hasBackdrop]="false" autosize>
  <mat-drawer #drawer mode="over">
    <mat-list>
      <div mat-subheader>Data Layer Observer Settings</div>
      <mat-list-item>
        <mat-checkbox [(ngModel)]="observerService.config.previewMode" [disabled]="true">_dlo_previewMode</mat-checkbox>
      </mat-list-item>
      <mat-list-item>
        <mat-checkbox [(ngModel)]="observerService.config.readOnLoad" [disabled]="true">_dlo_readOnLoad</mat-checkbox>
      </mat-list-item>
      <mat-list-item>
        <mat-checkbox [(ngModel)]="observerService.config.validateRules" [disabled]="true">_dlo_validateRules
        </mat-checkbox>
      </mat-list-item>
    </mat-list>
  </mat-drawer>

  <div class="sidenav" fxLayout="row" fxLayoutAlign="start stretch">
    <mat-tab-group #datalayerTabs fxFlex="40">
      <mat-tab label="Data Layer">
        <mat-card>
          <div fxLayout="row" fxLayoutAlign="start center">
            <mat-form-field class="full-width">
              <mat-label>variable</mat-label>
              <input required matInput [(ngModel)]="variable">
            </mat-form-field>
            <button mat-flat-button (click)="load(input.innerText)" color="primary">Load</button>
          </div>
          <pre #input id="input" class="datalayer-input" contenteditable="true">{{ datalayer }}</pre>
        </mat-card>
      </mat-tab>
      <mat-tab label="Observer Output">
        <mat-card>
          <pre>{{ output }}</pre>
        </mat-card>
      </mat-tab>
      <mat-tab label="Observer Log">
        <mat-card *ngFor="let event of logs">
          <mat-icon *ngIf="event.level === 0" color="warn">error</mat-icon>
          <mat-icon *ngIf="event.level === 1" color="accent">warning</mat-icon>
          {{ event.message }}
        </mat-card>
      </mat-tab>
    </mat-tab-group>
    <mat-tab-group fxFlex="60">
      <mat-tab label="Rule Set">
        <mat-accordion multi>
          <app-rule *ngFor="let rule of rules" [rule]="rule"></app-rule>
        </mat-accordion>
      </mat-tab>
    </mat-tab-group>
  </div>
</mat-drawer-container>

<mat-menu #loader="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="adobe">
    <span>Adobe</span>
  </button>
  <button mat-menu-item [matMenuTriggerFor]="ceddl">
    <span>CEDDL</span>
  </button>
  <button mat-menu-item [matMenuTriggerFor]="google">
    <span>Google</span>
  </button>
</mat-menu>

<mat-menu #adobe="matMenu">
  <button mat-menu-item (click)="loadSample('adobe-app-measurement')">AppMeasurement</button>
</mat-menu>

<mat-menu #ceddl="matMenu">
  <button mat-menu-item (click)="loadSample('ceddl-cart')">cart</button>
  <button mat-menu-item (click)="loadSample('ceddl-page')">page</button>
  <button mat-menu-item (click)="loadSample('ceddl-product')">product</button>
  <button mat-menu-item (click)="loadSample('ceddl-transaction')">transaction</button>
  <button mat-menu-item (click)="loadSample('ceddl-user')">user</button>
</mat-menu>

<mat-menu #google="matMenu">
  <button mat-menu-item (click)="loadSample('ga')">Analytics</button>
</mat-menu>
